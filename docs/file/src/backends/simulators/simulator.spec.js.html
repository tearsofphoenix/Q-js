<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/backends/simulators/simulator.spec.js | projectq</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#backends">backends</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/backends/printer.js~CommandPrinter.html">CommandPrinter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/backends/resource.js~ResourceCounter.html">ResourceCounter</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#backends-circuits">backends/circuits</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/backends/circuits/drawer.js~CircuitDrawer.html">CircuitDrawer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/backends/circuits/drawer.js~CircuitItem.html">CircuitItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/backends/circuits/tolatex.js~_Circ2Tikz.html">_Circ2Tikz</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-_exports">_exports</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#backends-ibm">backends/ibm</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/backends/ibm/ibm.js~IBMBackend.html">IBMBackend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/backends/ibm/ibmhttpclient.js~IBMHTTPClient.html">IBMHTTPClient</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#backends-simulators">backends/simulators</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/backends/simulators/classicalsimulator.js~ClassicalSimulator.html">ClassicalSimulator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/backends/simulators/jssim.js~Simulator.html">Simulator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/backends/simulators/shared.spec.js~TrivialMapper.html">TrivialMapper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/backends/simulators/simulator.js~Simulator.html">Simulator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-All">All</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#cengines">cengines</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/basicmapper.js~BasicMapperEngine.html">BasicMapperEngine</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/basics.js~BasicEngine.html">BasicEngine</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/basics.js~ForwarderEngine.html">ForwarderEngine</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/cmdmodifier.js~CommandModifier.html">CommandModifier</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/ibm5qubitmapper.js~IBM5QubitMapper.html">IBM5QubitMapper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/linearmapper.js~LinearMapper.html">LinearMapper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/main.js~MainEngine.html">MainEngine</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/manualmapper.js~ManualMapper.html">ManualMapper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/optimize.js~LocalOptimizer.html">LocalOptimizer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/swapandcnotflipper.js~SwapAndCNOTFlipper.html">SwapAndCNOTFlipper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/tagremover.js~TagRemover.html">TagRemover</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/testengine.js~CompareEngine.html">CompareEngine</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/testengine.js~DummyEngine.html">DummyEngine</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/twodmapper.js~GridMapper.html">GridMapper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-return_swap_depth">return_swap_depth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ibmqx4_connections">ibmqx4_connections</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#cengines-replacer">cengines/replacer</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/replacer/decompositionrule.js~DecompositionRule.html">DecompositionRule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/replacer/decompositionruleset.js~DecompositionRuleSet.html">DecompositionRuleSet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/replacer/replacer.js~AutoReplacer.html">AutoReplacer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cengines/replacer/replacer.js~InstructionFilter.html">InstructionFilter</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#libs">libs</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-arrayEqual">arrayEqual</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-arrayFromRange">arrayFromRange</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-complexVectorDot">complexVectorDot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-expmod">expmod</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-intersection">intersection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isComplex">isComplex</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isNumeric">isNumeric</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-len">len</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-narray">narray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-productLoop">productLoop</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-productLoop3">productLoop3</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randomSample">randomSample</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setDifference">setDifference</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setEqual">setEqual</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setFromRange">setFromRange</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setIsSuperSet">setIsSuperSet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-stringToBitArray">stringToBitArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-symmetricDifference">symmetricDifference</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-unionSet">unionSet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ObjectCopy">ObjectCopy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-arrayIsTuple">arrayIsTuple</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-classHierachy">classHierachy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-genString">genString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-instanceOf">instanceOf</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isKindclassOf">isKindclassOf</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isSubclassOf">isSubclassOf</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-markTuple">markTuple</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-matrixDot">matrixDot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-matrixGetRow">matrixGetRow</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-matrixRangeAssign">matrixRangeAssign</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-matrixRangeIndicesAssign">matrixRangeIndicesAssign</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-tuple">tuple</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-zeros">zeros</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#libs-math">libs/math</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/libs/math/gates.js~AddConstant.html">AddConstant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/libs/math/gates.js~AddConstantModN.html">AddConstantModN</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/libs/math/gates.js~MultiplyByConstantModN.html">MultiplyByConstantModN</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-add_constant">add_constant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-add_constant_modN">add_constant_modN</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-mul_by_constant_modN">mul_by_constant_modN</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SubConstant">SubConstant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SubConstantModN">SubConstantModN</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#meta">meta</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/compute.js~ComputeEngine.html">ComputeEngine</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/compute.js~UncomputeEngine.html">UncomputeEngine</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/control.js~ControlEngine.html">ControlEngine</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/dagger.js~DaggerEngine.html">DaggerEngine</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/error.js~LastEngineError.html">LastEngineError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/error.js~NoGateDecompositionError.html">NoGateDecompositionError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/error.js~NotMergeable.html">NotMergeable</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/error.js~NotYetMeasuredError.html">NotYetMeasuredError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/error.js~QubitManagementError.html">QubitManagementError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/loop.js~LoopEngine.html">LoopEngine</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/loop.js~LoopTag.html">LoopTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/tag.js~ComputeTag.html">ComputeTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/tag.js~DirtyQubitTag.html">DirtyQubitTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/tag.js~LogicalQubitIDTag.html">LogicalQubitIDTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/meta/tag.js~UncomputeTag.html">UncomputeTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Compute">Compute</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-CustomUncompute">CustomUncompute</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Uncompute">Uncompute</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Control">Control</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Dagger">Dagger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Loop">Loop</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-dropEngineAfter">dropEngineAfter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-insertEngine">insertEngine</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#ops">ops</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/basics.js~BasicGate.html">BasicGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/basics.js~BasicMathGate.html">BasicMathGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/basics.js~BasicPhaseGate.html">BasicPhaseGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/basics.js~BasicRotationGate.html">BasicRotationGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/basics.js~ClassicalInstructionGate.html">ClassicalInstructionGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/basics.js~FastForwardingGate.html">FastForwardingGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/basics.js~SelfInverseGate.html">SelfInverseGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/command.js~Command.html">Command</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~AllocateDirtyQubitGate.html">AllocateDirtyQubitGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~AllocateQubitGate.html">AllocateQubitGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~BarrierGate.html">BarrierGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~DeallocateQubitGate.html">DeallocateQubitGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~EntangleGate.html">EntangleGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~FlushGate.html">FlushGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~HGate.html">HGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~MeasureGate.html">MeasureGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~Ph.html">Ph</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~R.html">R</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~Rx.html">Rx</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~Ry.html">Ry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~Rz.html">Rz</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~SGate.html">SGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~SqrtSwapGate.html">SqrtSwapGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~SqrtXGate.html">SqrtXGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~SwapGate.html">SwapGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~TGate.html">TGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~XGate.html">XGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~YGate.html">YGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/gates.js~ZGate.html">ZGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/metagates.js~ControlledGate.html">ControlledGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/metagates.js~DaggeredGate.html">DaggeredGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/metagates.js~Tensor.html">Tensor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/qftgate.js~QFTGate.html">QFTGate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/qubitoperator.js~QubitOperator.html">QubitOperator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ops/timeevolution.js~TimeEvolution.html">TimeEvolution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-add">add</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get">get</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getInverse">getInverse</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-C">C</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-stringToArray">stringToArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-CRz">CRz</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Allocate">Allocate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AllocateDirty">AllocateDirty</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Entangle">Entangle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-H">H</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Measure">Measure</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-NOT">NOT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-S">S</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SqrtSwap">SqrtSwap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SqrtX">SqrtX</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Swap">Swap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-T">T</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-X">X</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Y">Y</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Z">Z</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-obj">obj</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-All">All</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-QFT">QFT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PAULI_OPERATOR_PRODUCTS">PAULI_OPERATOR_PRODUCTS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CNOT">CNOT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CX">CX</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CZ">CZ</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Toffoli">Toffoli</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#setups">setups</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getEngineList">getEngineList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-high_level_gates">high_level_gates</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getEngineList">getEngineList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getEngineList">getEngineList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getEngineList">getEngineList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getEngineList">getEngineList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getEngineList">getEngineList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ibmqx5_connections">ibmqx5_connections</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#setups-decompositions">setups/decompositions</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_find_parameters">_find_parameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_recognize_arb1qubit">_recognize_arb1qubit</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-phase">phase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_test_matrices">create_test_matrices</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_decompose_barrier">_decompose_barrier</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_recognize_barrier">_recognize_barrier</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_recognize_carb1qubit">_recognize_carb1qubit</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_recognize_v">_recognize_v</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_recognize_cnot">_recognize_cnot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_decompose_CnU">_decompose_CnU</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_recognize_CnU">_recognize_CnU</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_recognize_RxNoCtrl">_recognize_RxNoCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_decompose_ry">_decompose_ry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_recognize_RyNoCtrl">_recognize_RyNoCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-rule_commuting_terms">rule_commuting_terms</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-rule_individual_terms">rule_individual_terms</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#types">types</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/types/qubit.js~BasicQubit.html">BasicQubit</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/types/qubit.js~Qubit.html">Qubit</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Qureg">Qureg</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/backends/simulators/simulator.spec.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/*
 * Copyright (c) 2018 Isaac Phoenix (tearsofphoenix@icloud.com).
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import {expect} from &apos;chai&apos;
import math from &apos;mathjs&apos;
import {TrivialMapper} from &apos;./shared.spec&apos;
import {BasicGate, BasicMathGate} from &apos;../../ops/basics&apos;
import {DummyEngine} from &apos;../../cengines/testengine&apos;;
import MainEngine from &apos;../../cengines/main&apos;;
import {
  Allocate, H, Measure, X, Y, Rx, Ry, Rz, Z, S
} from &apos;../../ops/gates&apos;;
import Simulator from &apos;./simulator&apos;
import {len} from &apos;../../libs/polyfill&apos;;
import { CNOT, Toffoli } from &apos;../../ops/shortcuts&apos;;
import {tuple} from &apos;../../libs/util&apos;;
import {All} from &apos;../../ops/metagates&apos;;
import {BasicQubit} from &apos;../../types/qubit&apos;;
import Command from &apos;../../ops/command&apos;;
import {LogicalQubitIDTag} from &apos;../../meta/tag&apos;;
import {NotYetMeasuredError} from &apos;../../meta/error&apos;;
import {Control} from &apos;../../meta/control&apos;;
import {Dagger} from &apos;../../meta/dagger&apos;;
import LocalOptimizer from &apos;../../cengines/optimize&apos;;
import QubitOperator, {stringToArray} from &apos;../../ops/qubitoperator&apos;;
import BasicMapperEngine from &apos;../../cengines/basicmapper&apos;
import TimeEvolution from &apos;../../ops/timeevolution&apos;;

/**
 *
 * @param m {Matrix}
 * @param idx {number}
 * @return {Complex}
 */
function getMatrixValue(m, idx) {
  let v
  if (m.subset) {
    v = m.subset(math.index(idx))
  } else {
    v = m[idx]
  }
  if (typeof v === &apos;number&apos;) {
    v = math.complex(v, 0)
  }
  return v
}

class Mock1QubitGate extends BasicGate {
  constructor() {
    super()
    this.cnt = 0
  }

  get matrix() {
    this.cnt += 1
    return math.matrix([[0, 1], [1, 0]])
  }
}

class Mock6QubitGate extends BasicGate {
  constructor() {
    super()
    this.cnt = 0
  }

  get matrix() {
    this.cnt += 1
    return math.identity(2 ** 6)
  }
}

class MockNoMatrixGate extends BasicGate {
  constructor() {
    super()
    this.cnt = 0
  }

  get matrix() {
    this.cnt += 1
    throw new Error(&apos;AttributeError&apos;)
  }
}

class Plus2Gate extends BasicMathGate {
  constructor() {
    super((x) =&gt; {
      return [x + 2]
    })
  }
}

function convertNativeMatrix(vec) {
  const m = math.zeros(vec.length)
  vec.forEach((val, idx) =&gt; {
    m.subset(math.index(idx), math.complex(val.re, val.im))
  })
  return m
}

const settings = [
  [&apos;CPP Simulator Test&apos;, false, null, false],
  [&apos;JS Simulator Test&apos;, false, null, true]
]

settings.forEach(([testName, gate_fusion, rndSeed, forceSimulation]) =&gt; {
  describe(testName, () =&gt; {
    it(&apos;should test_simulator_is_available&apos;, () =&gt; {
      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)

      const backend = new DummyEngine(true)
      const eng = new MainEngine(backend, [])
      const qubit = eng.allocateQubit()
      Measure.or(qubit)
      new BasicMathGate(x =&gt; x).or(qubit)
      qubit[0].deallocate()

      expect(backend.receivedCommands.length).to.equal(4)

      // Test that allocate, measure, basic math, and deallocate are available.
      backend.receivedCommands.forEach(cmd =&gt; sim.isAvailable(cmd))

      const new_cmd = backend.receivedCommands[backend.receivedCommands.length - 1]

      new_cmd.gate = new Mock1QubitGate()
      expect(sim.isAvailable(new_cmd)).to.equal(true)
      expect(new_cmd.gate.cnt).to.equal(1)

      new_cmd.gate = new Mock6QubitGate()
      expect(sim.isAvailable(new_cmd)).to.equal(false)
      expect(new_cmd.gate.cnt).to.equal(1)

      new_cmd.gate = new MockNoMatrixGate()

      expect(sim.isAvailable(new_cmd)).to.equal(false)
      expect(new_cmd.gate.cnt).to.equal(1)
    });

    it(&apos;should test_simulator_cheat&apos;, () =&gt; {
      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)

      // cheat function should return a tuple
      expect(Array.isArray(sim.cheat())).to.equal(true)
      // first entry is the qubit mapping.
      // should be empty:

      expect(Object.keys(sim.cheat()[0]).length).to.equal(0)
      // state vector should only have 1 entry:
      expect(len(sim.cheat()[1])).to.equal(1)
      const eng = new MainEngine(sim, [])
      const qubit = eng.allocateQubit()

      // one qubit has been allocated
      expect(len(sim.cheat()[0])).to.equal(1)
      expect(sim.cheat()[0][0]).to.equal(0)

      expect(len(sim.cheat()[1])).to.equal(2)
      const v = getMatrixValue(sim.cheat()[1], 0)

      expect(v.re).to.equal(1)
      expect(v.im).to.equal(0)

      qubit[0].deallocate()
      // should be empty:
      expect(Object.keys(sim.cheat()[0]).length).to.equal(0)
      // state vector should only have 1 entry:
      expect(len(sim.cheat()[1])).to.equal(1)
    });

    it(&apos;should test_simulator_functional_measurement&apos;, () =&gt; {
      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)

      const eng = new MainEngine(sim, [])
      const qubits = eng.allocateQureg(5)
      // entangle all qubits:
      H.or(qubits[0])
      qubits.slice(1).forEach((qb) =&gt; {
        CNOT.or(tuple(qubits[0], qb))
      })

      new All(Measure).or(qubits)

      const bit_value_sum = qubits.reduce((accu, current) =&gt; accu + current.toNumber(), 0)
      expect(bit_value_sum === 0 || bit_value_sum === 5).to.equal(true)
    });

    it(&apos;should test_simulator_measure_mapped_qubit&apos;, () =&gt; {
      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)

      const eng = new MainEngine(sim, [])
      const qb1 = new BasicQubit(eng, 1)
      const qb2 = new BasicQubit(eng, 2)
      const cmd0 = new Command(eng, Allocate, tuple([qb1]))
      const cmd1 = new Command(eng, X, tuple([qb1]))
      const cmd2 = new Command(eng, Measure, tuple([qb1]), [], [new LogicalQubitIDTag(2)])

      expect(() =&gt; qb1.toNumber()).to.throw(NotYetMeasuredError)
      expect(() =&gt; qb2.toNumber()).to.throw(NotYetMeasuredError)
      eng.send([cmd0, cmd1, cmd2])
      eng.flush()

      expect(() =&gt; qb1.toNumber()).to.throw(NotYetMeasuredError)
      expect(qb2.toNumber()).to.equal(1)
    });

    it(&apos;should test_simulator_emulation&apos;, () =&gt; {
      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)

      const eng = new MainEngine(sim, [])
      const qubit1 = eng.allocateQubit()
      const qubit2 = eng.allocateQubit()
      const qubit3 = eng.allocateQubit()

      Control(eng, qubit3, () =&gt; new Plus2Gate().or(tuple(qubit1.concat(qubit2))))

      let v = getMatrixValue(sim.cheat()[1], 0)
      expect(v.re).to.equal(1)
      X.or(qubit3)
      Control(eng, qubit3, () =&gt; new Plus2Gate().or(tuple(qubit1.concat(qubit2))))
      v = getMatrixValue(sim.cheat()[1], 6)
      expect(v.re).to.equal(1)
      expect(v.im).to.equal(0)

      new All(Measure).or(tuple(qubit1.concat(qubit2).concat(qubit3)))
    });

    it(&apos;should test_simulator_kqubit_gate&apos;, () =&gt; {
      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)
      const m1 = new Rx(0.3).matrix
      const m2 = new Rx(0.8).matrix
      const m3 = new Ry(0.1).matrix
      const m4 = math.multiply(new Rz(0.9).matrix, new Ry(-0.1).matrix)
      const m = math.kron(m4, math.kron(m3, math.kron(m2, m1)))

      class KQubitGate extends BasicGate {
        get matrix() {
          return m
        }
      }

      const eng = new MainEngine(sim, [])
      const qureg = eng.allocateQureg(4)
      const qubit = eng.allocateQubit()
      new Rx(-0.3).or(qureg[0])
      new Rx(-0.8).or(qureg[1])
      new Ry(-0.1).or(qureg[2])
      new Rz(-0.9).or(qureg[3])
      new Ry(0.1).or(qureg[3])

      X.or(qubit)
      console.log(&apos;-------------------------------------------------&apos;)
      Control(eng, qubit, () =&gt; new KQubitGate().or(qureg))
      console.log(&apos;-------------------------------------------------&apos;)

      X.or(qubit)

      Control(eng, qubit, () =&gt; Dagger(eng, () =&gt; new KQubitGate().or(qureg)))

      expect(sim.getAmplitude(&apos;00000&apos;, qubit.concat(qureg)).re).to.be.closeTo(1, 1e-12)

      class LargerGate extends BasicGate {
        get matrix() {
          return math.identiy(2 ** 6)
        }
      }

      expect(() =&gt; new LargerGate().or(tuple(qureg.concat(qubit)))).to.throw()
    });

    it(&apos;should test_simulator_kqubit_exception&apos;, () =&gt; {
      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)

      const m1 = new Rx(0.3).matrix
      const m2 = new Rx(0.8).matrix
      const m3 = new Ry(0.1).matrix
      const m4 = math.multiply(new Rz(0.9).matrix, new Ry(-0.1).matrix)
      const m = math.kron(m4, math.kron(m3, math.kron(m2, m1)))

      class KQubitGate extends BasicGate {
        get matrix() {
          return m
        }
      }

      const eng = new MainEngine(sim, [])
      const qureg = eng.allocateQureg(3)
      expect(() =&gt; new KQubitGate().or(qureg)).to.throw()
      expect(() =&gt; H.or(qureg)).to.throw()
    });

    it(&apos;should test_simulator_probability&apos;, () =&gt; {
      const mp = new TrivialMapper()

      const test = (mapper) =&gt; {
        const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)

        const engine_list = [new LocalOptimizer()]
        if (mapper) {
          engine_list.push(mapper)
        }

        const eng = new MainEngine(sim, engine_list)
        const qubits = eng.allocateQureg(6)
        new All(H).or(qubits)
        eng.flush()
        const bits = [0, 0, 1, 0, 1, 0]
        for (let i = 0; i &lt; 6; ++i) {
          expect(eng.backend.getProbability(bits.slice(0, i), qubits.slice(0, i))).to.be.closeTo(0.5 ** i, 1e-12)
        }

        const extra_qubit = eng.allocateQubit()
        expect(() =&gt; eng.backend.getProbability([0], extra_qubit)).to.throw()

        extra_qubit.deallocate()
        new All(H).or(qubits)
        new Ry(2 * math.acos(math.sqrt(0.3))).or(qubits[0])
        eng.flush()
        expect(eng.backend.getProbability([0], [qubits[0]])).to.be.closeTo(0.3, 1e-12)

        new Ry(2 * math.acos(math.sqrt(0.4))).or(qubits[2])
        eng.flush()
        expect(eng.backend.getProbability([0], [qubits[2]])).to.be.closeTo(0.4, 1e-12)

        expect(eng.backend.getProbability([0, 0], [qubits[0], qubits[2]])).to.be.closeTo(0.12, 1e-12)
        expect(eng.backend.getProbability([0, 1], [qubits[0], qubits[2]])).to.be.closeTo(0.18, 1e-12)
        expect(eng.backend.getProbability([1, 0], [qubits[0], qubits[2]])).to.be.closeTo(0.28, 1e-12)
        new All(Measure).or(qubits)
      }

      test(mp)
      test()
    });

    it(&apos;should test_simulator_amplitude&apos;, () =&gt; {
      const mp = new TrivialMapper()
      const test = (mapper) =&gt; {
        const engine_list = [new LocalOptimizer()]
        if (mapper) {
          engine_list.push(mapper)
        }

        const eng = new MainEngine(new Simulator(gate_fusion, rndSeed, forceSimulation), engine_list)
        const qubits = eng.allocateQureg(6)
        new All(X).or(qubits)
        new All(H).or(qubits)
        eng.flush()
        let bits = [0, 0, 1, 0, 1, 0]
        expect(eng.backend.getAmplitude(bits, qubits).re).to.be.closeTo(1.0 / 8, 1e-12)
        bits = [0, 0, 0, 0, 1, 0]

        expect(eng.backend.getAmplitude(bits, qubits).re).to.be.closeTo(-1.0 / 8, 1e-12)
        bits = [0, 1, 1, 0, 1, 0]
        expect(eng.backend.getAmplitude(bits, qubits).re).to.be.closeTo(-1.0 / 8, 1e-12)
        new All(H).or(qubits)
        new All(X).or(qubits)
        new Ry(2 * math.acos(0.3)).or(qubits[0])
        eng.flush()
        bits = [0, 0, 0, 0, 0, 0]
        expect(eng.backend.getAmplitude(bits, qubits).re).to.be.closeTo(0.3, 1e-12)
        bits[0] = 1
        expect(eng.backend.getAmplitude(bits, qubits).re).to.be.closeTo(math.sqrt(0.91), 1e-12)

        new All(Measure).or(qubits)
        // raises if not all qubits are in the list:
        expect(() =&gt; eng.backend.getAmplitude(bits, qubits.slice(0, qubits.length - 1))).to.throw()

        // doesn&apos;t just check for length:
        expect(() =&gt; eng.backend.getAmplitude(bits, qubits.slice(0, qubits.length - 1).concat(qubits[0]))).to.throw()
        const extra_qubit = eng.allocateQubit()
        eng.flush()
        // there is a new qubit now!
        expect(() =&gt; eng.backend.getAmplitude(bits, qubits)).to.throw()
      }
      test(mp)
      test()
    });

    it(&apos;should test_simulator_expectation&apos;, () =&gt; {
      const mp = new TrivialMapper()

      const test = (mapper) =&gt; {
        const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)
        const engine_list = mapper ? [mapper] : []

        const eng = new MainEngine(sim, engine_list)
        const qureg = eng.allocateQureg(3)
        const op0 = new QubitOperator(&apos;Z0&apos;)
        let expectation = sim.getExpectationValue(op0, qureg)
        expect(math.re(expectation)).to.equal(1)

        X.or(qureg[0])
        expectation = sim.getExpectationValue(op0, qureg)
        expect(expectation).to.equal(-1)

        H.or(qureg[0])
        const op1 = new QubitOperator(&apos;X0&apos;)
        expectation = sim.getExpectationValue(op1, qureg)
        expect(expectation).to.be.closeTo(-1, 1e-12)

        Z.or(qureg[0])
        expectation = sim.getExpectationValue(op1, qureg)
        expect(expectation).to.be.closeTo(1, 1e-12)

        X.or(qureg[0])
        S.or(qureg[0])
        Z.or(qureg[0])
        X.or(qureg[0])

        const op2 = new QubitOperator(&apos;Y0&apos;)
        expectation = sim.getExpectationValue(op2, qureg)
        expect(expectation).to.be.closeTo(1, 1e-12)

        Z.or(qureg[0])
        expectation = sim.getExpectationValue(op2, qureg)
        expect(expectation).to.be.closeTo(-1, 1e-12)

        let op_sum = new QubitOperator(&apos;Y0 X1 Z2&apos;).add(new QubitOperator(&apos;X1&apos;))
        H.or(qureg[1])
        X.or(qureg[2])
        expectation = sim.getExpectationValue(op_sum, qureg)

        expect(expectation).to.be.closeTo(2, 1e-12)

        op_sum = new QubitOperator(&apos;Y0 X1 Z2&apos;).add(new QubitOperator(&apos;X1&apos;))
        X.or(qureg[2])
        expectation = sim.getExpectationValue(op_sum, qureg)

        expect(expectation).to.be.closeTo(0, 1e-12)

        const op_id = new QubitOperator([]).mul(0.4)
        expectation = sim.getExpectationValue(op_id, qureg)
        expect(expectation).to.be.closeTo(0.4, 1e-12)
      }
      test(mp)
      test()
    });

    it(&apos;should test_simulator_expectation_exception&apos;, () =&gt; {
      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)
      const eng = new MainEngine(sim, [])
      const qureg = eng.allocateQureg(3)
      const op = new QubitOperator(&apos;Z2&apos;)
      sim.getExpectationValue(op, qureg)
      const op2 = new QubitOperator(&apos;Z3&apos;)
      expect(() =&gt; sim.getExpectationValue(op2, qureg)).to.throw()
      const op3 = new QubitOperator(&apos;Z1&apos;).add(new QubitOperator(&apos;X1 Y3&apos;))
      expect(() =&gt; sim.getExpectationValue(op3, qureg)).to.throw()
    });

    it(&apos;should test_simulator_applyqubitoperator_exception&apos;, () =&gt; {
      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)
      const eng = new MainEngine(sim, [])
      const qureg = eng.allocateQureg(3)
      const op = new QubitOperator(&apos;Z2&apos;)
      sim.applyQubitOperator(op, qureg)
      const op2 = new QubitOperator(&apos;Z3&apos;)
      expect(() =&gt; sim.applyQubitOperator(op2, qureg)).to.throw()
      const op3 = new QubitOperator(&apos;Z1&apos;).add(new QubitOperator(&apos;X1 Y3&apos;))
      expect(() =&gt; sim.applyQubitOperator(op3, qureg)).to.throw()
    });

    it(&apos;should test_simulator_applyqubitoperator&apos;, () =&gt; {
      const mp = new TrivialMapper()

      const test = (mapper) =&gt; {
        const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)
        const engine_list = mapper ? [mapper] : []

        const eng = new MainEngine(sim, engine_list)
        const qureg = eng.allocateQureg(3)
        let v = sim.cheat()
        const op = new QubitOperator(&apos;X0 Y1 Z2&apos;)
        sim.applyQubitOperator(op, qureg)
        v = sim.cheat()
        X.or(qureg[0])
        v = sim.cheat()
        Y.or(qureg[1])
        v = sim.cheat()
        Z.or(qureg[2])
        v = sim.cheat()
        let ret = sim.getAmplitude(&apos;000&apos;, qureg)
        v = sim.cheat()
        expect(ret.re).to.be.closeTo(1, 1e-12)

        H.or(qureg[0])
        const op_H = (new QubitOperator(&apos;X0&apos;).add(new QubitOperator(&apos;Z0&apos;))).mul(1.0 / math.sqrt(2.0))
        sim.applyQubitOperator(op_H, [qureg[0]])

        ret = sim.getAmplitude(&apos;000&apos;, qureg)
        expect(ret.re).to.be.closeTo(1, 1e-12)

        const op_Proj0 = new QubitOperator(&apos;&apos;).add(new QubitOperator(&apos;Z0&apos;)).mul(0.5)
        const op_Proj1 = new QubitOperator(&apos;&apos;).sub(new QubitOperator(&apos;Z0&apos;)).mul(0.5)
        H.or(qureg[0])
        sim.applyQubitOperator(op_Proj0, [qureg[0]])

        ret = sim.getAmplitude(&apos;000&apos;, qureg)
        expect(ret.re).to.be.closeTo(1.0 / math.sqrt(2.0), 1e-12)
        sim.applyQubitOperator(op_Proj1, [qureg[0]])

        ret = sim.getAmplitude(&apos;000&apos;, qureg)
        expect(ret.re).to.be.closeTo(0, 1e-12)
      }

      test(mp)
      test()
    });

    it(&apos;should test_simulator_time_evolution&apos;, function () {
      this.timeout(600 * 1000)

      console.log(&apos;start time evolution&apos;, Date.now())

      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)
      const N = 8 // number of qubits
      const time_to_evolve = 1.1 // time to evolve for
      const eng = new MainEngine(sim, [])
      const qureg = eng.allocateQureg(N)
      // initialize in random wavefunction by applying some gates:
      qureg.forEach((qb) =&gt; {
        new Rx(Math.random()).or(qb)
        new Ry(Math.random()).or(qb)
      })
      eng.flush()
      // Use cheat to get initial start wavefunction:
      let [_, init_wavefunction] = eng.backend.cheat()
      init_wavefunction = math.clone(init_wavefunction)
      const Qop = QubitOperator
      const op = new Qop(&apos;X0 Y1 Z2 Y3 X4&apos;).mul(0.3)
      op.iadd(new Qop([]).mul(1.1))
      op.iadd(new Qop(&apos;Y0 Z1 X3 Y5&apos;).mul(-1.4))
      op.iadd(new Qop(&apos;Y1 X2 X3 Y4&apos;).mul(-1.1))
      const ctrl_qubit = eng.allocateQubit()
      H.or(ctrl_qubit)
      Control(eng, ctrl_qubit, () =&gt; new TimeEvolution(time_to_evolve, op).or(qureg))
      eng.flush()
      let [qbit_to_bit_map2, final_wavefunction] = eng.backend.cheat()
      final_wavefunction = math.clone(final_wavefunction)
      const map = {}
      Object.assign(map, qbit_to_bit_map2)
      qbit_to_bit_map2 = map
      new All(Measure).or(qureg.concat(ctrl_qubit))

      console.log(&apos;end time evolution&apos;, Date.now())
      // Check manually:

      const build_matrix = (list_single_matrices) =&gt; {
        let res = list_single_matrices[0]
        for (let i = 1; i &lt; len(list_single_matrices); ++i) {
          res = math.kron(res, list_single_matrices[i])
        }
        return res
      }
      const mc = math.complex
      const id_sp = math.identity(2, &apos;sparse&apos;)
      const x_sp = math.sparse([[0.0, 1.0], [1.0, 0.0]])
      const y_sp = math.sparse([[0.0, mc(0, -1.0)], [mc(0, 1.0), 0.0]])
      const z_sp = math.sparse([[1.0, 0.0], [0.0, -1.0]])
      const gates = {X: x_sp, Y: y_sp, Z: z_sp}

      let res_matrix = 0
      Object.keys(op.terms).forEach((k) =&gt; {
        // id_sp * N
        const matrix = [id_sp, id_sp, id_sp, id_sp, id_sp, id_sp, id_sp, id_sp]
        const t = stringToArray(k)
        const c = op.terms[k]
        t.forEach(([idx, gate]) =&gt; {
          matrix[qbit_to_bit_map2[qureg[idx].id]] = gates[gate]
        })
        matrix.reverse()
        res_matrix = math.add(res_matrix, math.multiply(build_matrix(matrix), c))
      })

      res_matrix = math.multiply(res_matrix, mc(0, -time_to_evolve))

      init_wavefunction = math.flatten(init_wavefunction)
      init_wavefunction = convertNativeMatrix(init_wavefunction)
      final_wavefunction = math.flatten(final_wavefunction)
      final_wavefunction = convertNativeMatrix(final_wavefunction)

      console.log(&apos;tick&apos;, Date.now())
      const res = math.multiply(math.expm(res_matrix), init_wavefunction)
      console.log(&apos;tick&apos;, Date.now())

      const count = len(final_wavefunction)
      const half = Math.floor(count / 2)
      const hadamard_f = 1.0 / math.sqrt(2.0)
      // check evolution and control
      const tail = getMatrixValue(final_wavefunction, math.range(half, count))
      const head = getMatrixValue(final_wavefunction, math.range(0, half))
      const ra = math.multiply(hadamard_f, res)
      console.log(ra, tail)
      expect(math.deepEqual(ra, tail)).to.equal(true)
      expect(math.deepEqual(head, math.multiply(hadamard_f, init_wavefunction))).to.equal(true)
    });

    it(&apos;should test_simulator_set_wavefunction&apos;, () =&gt; {
      const mp = new TrivialMapper()

      const test = (mapper) =&gt; {
        const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)
        const engine_list = [new LocalOptimizer()]
        if (mapper) {
          engine_list.push(mapper)
        }

        const eng = new MainEngine(sim, engine_list)
        const qubits = eng.allocateQureg(2)
        const wf = [0.0, 0.0, math.sqrt(0.2), math.sqrt(0.8)]
        expect(() =&gt; eng.backend.setWavefunction(wf, qubits)).to.throw()
        eng.flush()
        eng.backend.setWavefunction(wf, qubits)

        expect(eng.backend.getProbability(&apos;1&apos;, [qubits[0]])).to.be.closeTo(0.8, 1e-12)
        expect(eng.backend.getProbability(&apos;01&apos;, qubits)).to.be.closeTo(0.2, 1e-12)
        expect(eng.backend.getProbability(&apos;1&apos;, [qubits[1]])).to.be.closeTo(1, 1e-12)
        new All(Measure).or(qubits)
      }

      test(mp)
      test()
    });

    it(&apos;should test_simulator_set_wavefunction_always_complex&apos;, () =&gt; {
      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)
      const eng = new MainEngine(sim)
      const qubit = eng.allocateQubit()
      eng.flush()
      const wf = [1.0, 0]
      eng.backend.setWavefunction(wf, qubit)
      Y.or(qubit)
      eng.flush()
      const c = eng.backend.getAmplitude(&apos;1&apos;, qubit)
      expect(math.abs(math.complex(c.re, c.im))).to.be.closeTo(1, 1e-12)
    });

    it(&apos;should test_simulator_collapse_wavefunction&apos;, () =&gt; {
      const mp = new TrivialMapper()
      const test = (mapper) =&gt; {
        const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)
        const engine_list = [new LocalOptimizer()]
        if (mapper) {
          engine_list.push(mapper)
        }

        const eng = new MainEngine(sim, engine_list)
        const qubits = eng.allocateQureg(4)
        // unknown qubits: raises
        expect(() =&gt; eng.backend.collapseWavefunction(qubits, [0, 0, 0, 0])).to.throw()
        eng.flush()
        eng.backend.collapseWavefunction(qubits, [0, 0, 0, 0])
        const v = eng.backend.getProbability([0, 0, 0, 0], qubits)
        console.log(544, v)
        expect(v).to.be.closeTo(1, 1e-12)
        new All(H).or(qubits.slice(1))
        eng.flush()
        expect(eng.backend.getProbability([0, 0, 0, 0], qubits)).to.be.closeTo(0.125, 1e-12)

        // impossible outcome: raises
        expect(() =&gt; eng.backend.collapseWavefunction(qubits, [1, 0, 0, 0])).to.throw()
        eng.backend.collapseWavefunction(qubits.slice(0, qubits.length - 1), [0, 1, 0])
        let probability = eng.backend.getProbability([0, 1, 0, 1], qubits)
        expect(probability).to.be.closeTo(0.5, 1e-12)

        eng.backend.setWavefunction([1.0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], qubits)
        H.or(qubits[0])
        CNOT.or(tuple(qubits[0], qubits[1]))
        eng.flush()
        eng.backend.collapseWavefunction([qubits[0]], [1])
        probability = eng.backend.getProbability([1, 1], qubits.slice(0, 2))
        expect(probability).to.be.closeTo(1, 1e-12)
      }
      test(mp)
      test()
    });

    it(&apos;should test_simulator_no_uncompute_exception&apos;, () =&gt; {
      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)
      const eng = new MainEngine(sim, [])
      const qubit = eng.allocateQubit()
      H.or(qubit)
      expect(() =&gt; qubit[0].deallocate()).to.throw()

      // If you wanted to keep using the qubit, you shouldn&apos;t have deleted it.
      expect(qubit[0].id).to.equal(-1)
    });

    it(&apos;should test_simulator_flush&apos;, () =&gt; {
      class MockSimulatorBackend {
        constructor() {
          this.run_cnt = 0
        }

        run() {
          this.run_cnt += 1
        }
      }

      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)
      sim._simulator = new MockSimulatorBackend()

      const eng = new MainEngine(sim)
      eng.flush()

      expect(sim._simulator.run_cnt).to.equal(1)
    });

    it(&apos;should test_simulator_send&apos;, () =&gt; {
      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)
      const backend = new DummyEngine(true)

      const eng = new MainEngine(backend, [sim])

      const qubit = eng.allocateQubit()
      H.or(qubit)
      Measure.or(qubit)
      qubit.deallocate()
      eng.flush()

      expect(len(backend.receivedCommands)).to.equal(5)
    });

    it(&apos;should test_simulator_functional_entangle&apos;, () =&gt; {
      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)
      const eng = new MainEngine(sim, [])
      const qubits = eng.allocateQureg(5)
      // entangle all qubits:
      H.or(qubits[0])
      qubits.slice(1).forEach(qb =&gt; CNOT.or(tuple(qubits[0], qb)))

      // check the state vector:
      let m = sim.cheat()[1]
      m = convertNativeMatrix(m)
      expect(math.abs(getMatrixValue(m, 0)) ** 2).to.be.closeTo(0.5, 1e-12)
      expect(math.abs(getMatrixValue(m, 31)) ** 2).to.be.closeTo(0.5, 1e-12)

      for (let i = 1; i &lt; 31; ++i) {
        let v = sim.cheat()[1][i]
        v = math.complex(v.re, v.im)
        expect(math.abs(v)).to.be.closeTo(0, 1e-12)
      }

      // unentangle all except the first 2
      qubits.slice(2).forEach(qb =&gt; CNOT.or(tuple(qubits[0], qb)))

      // entangle using Toffolis
      qubits.slice(2).forEach(qb =&gt; Toffoli.or(tuple(qubits[0], qubits[1], qb)))

      // check the state vector:
      console.log(sim.cheat()[1][0], sim.cheat()[1][31])

      m = sim.cheat()[1]
      m = convertNativeMatrix(m)
      const v31 = math.re(math.abs(getMatrixValue(m, 31)))
      expect(math.re(math.abs(getMatrixValue(m, 0)))).to.be.closeTo(Math.SQRT1_2, 1e-12)
      expect(v31).to.be.closeTo(Math.SQRT1_2, 1e-12)

      for (let i = 1; i &lt; 31; ++i) {
        let v = sim.cheat()[1][i]
        v = math.complex(v.re, v.im)
        expect(math.abs(v)).to.be.closeTo(0, 1e-12)
      }

      // uncompute using multi-controlled NOTs
      Control(eng, qubits.slice(0, qubits.length - 1), () =&gt; X.or(qubits[qubits.length - 1]))
      Control(eng, qubits.slice(0, qubits.length - 2), () =&gt; X.or(qubits[qubits.length - 2]))
      Control(eng, qubits.slice(0, qubits.length - 3), () =&gt; X.or(qubits[qubits.length - 3]))
      CNOT.or(tuple(qubits[0], qubits[1]))
      H.or(qubits[0])

      // check the state vector:
      const mm = sim.cheat()[1]
      let v0 = getMatrixValue(mm, 0)
      v0 = math.complex(v0.re, v0.im)
      expect(math.re(math.abs(v0))).to.be.closeTo(1, 1e-12)
      for (let i = 1; i &lt; 32; ++i) {
        let v = sim.cheat()[1][i]
        v = math.complex(v.re, v.im)
        expect(math.re(math.abs(v))).to.be.closeTo(0, 1e-12)
      }

      new All(Measure).or(qubits)
    });

    it(&apos;should test_simulator_convert_logical_to_mapped_qubits&apos;, () =&gt; {
      const sim = new Simulator(gate_fusion, rndSeed, forceSimulation)
      const mapper = new BasicMapperEngine()

      const receive = (command_list) =&gt; { }

      mapper.receive = receive
      const eng = new MainEngine(sim, [mapper])
      const qubit0 = eng.allocateQubit()
      const qubit1 = eng.allocateQubit()
      mapper.currentMapping = {
        [qubit0[0].id]: qubit1[0].id,
        [qubit1[0].id]: qubit0[0].id
      }
      expect(sim.convertLogicalToMappedQureg(qubit0.concat(qubit1))).to.deep.equal(qubit1.concat(qubit0))
    });
  })
})
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
